# HTTP Capture Server Strategy Configuration
# ==========================================

[server]
# Runtime intervals (hot-reload)
sample_interval_sec = 1
batch_compress_interval_sec = 300
queue_timer_interval_ms = 50

[capture]
# Defaults for new capture tasks
default_interface = any
default_duration = 60
default_category = diag
file_pattern = {day}/{date}-{iface}-{proc}-{port}.pcap
output_dir = /var/log/rxtrace/captures
max_file_size_mb = 200
# Optional fallback if file_pattern is not set
# filename_prefix = capture_

[storage]
base_dir = /var/log/rxtrace/captures
compress_enabled = true
compress_cmd = gzip -9
compress_remove_src = false
max_age_days = 7
max_size_gb = 100

[sample]
# Queue and trigger thresholds (hot-reload)
worker_queue_size = 1024
cpu_pct_gt = 85
mem_pct_gt = 90
net_rx_kbps_gt = 8000

[sample.cpu_surged]
# Trigger capture on high overall CPU
cpu_pct_gt = 85
trigger_capture = iface:any
capture_duration_sec = 90
cooldown_sec = 300

[sample.memory_spike]
# Trigger capture when memory pressure is high
mem_pct_gt = 92
trigger_capture = iface:any
capture_duration_sec = 60
cooldown_sec = 600

[sample.nginx_hotspot]
# Observe nginx when its network usage surges
net_rx_kbps_gt = 12000
trigger_capture = process:nginx
capture_category = auto-nginx
capture_duration_sec = 120
cooldown_sec = 900

[cleanup]
# Cleanup thread configuration
compress_interval_sec = 600
record_dir = /var/log/rxtrace/cleanup
record_max_size_mb = 50
record_max_files = 5
compress_threshold_mb = 1024
archive_dir = /var/log/rxtrace/archives
archive_format = tar.gz
archive_keep_days = 14
# Maximum cumulative size of archive files in MB (0 disables size pruning)
archive_max_total_size_mb = 0
archive_remove_source = true

[security]
max_concurrent_captures = 10

[protocols]
# Protocol name to PDEF file mapping
# When using "protocol": "mysql" in API, it will automatically use the mapped PDEF file
# Uncomment to enable protocol-specific capture
mysql = config/protocols/mysql.pdef
redis = config/protocols/redis.pdef
http = config/protocols/http.pdef
dns = config/protocols/dns.pdef
mqtt = config/protocols/mqtt.pdef
iec104 = config/protocols/iec104.pdef
memcached = config/protocols/memcached.pdef
